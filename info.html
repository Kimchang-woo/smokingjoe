<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•´ìš´ëŒ€ ê´€ê´‘ ì •ë³´</title>
    <script defer src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2237e1d4164afe675ac45fd0c6310ad4&libraries=services&autoload=false"></script>

    <style>
        @font-face {
            font-family: 'MyFont';
            src: url(../BusanFont.ttf) format('ttf');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'MyFont', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            width: 100vw;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        #map {
            width: 100%;
            height: 500px;
        }

        .toggle-traffic {
            margin: 10px 0;
            padding: 10px;
            background-color: #002d72;
            color: white border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 5px;
        }


        .toggle-traffic:hover {
            background: #ff5910;
        }

        header {
            display: flex;
            width: 100%;
            height: 8rem;
            justify-content: space-between;
            align-items: center;
            background-color: #002d72;
            padding: 0 2rem;
        }

        .logo {
            width: 7rem;
            height: 7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 80%;
            height: auto;
            object-fit: contain;
        }

        nav {
            display: flex;
            color: #ffffff;
            justify-content: space-around;
            width: 50rem;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .hdicons {
            width: 12rem;
            height: 7rem;
            margin-right: 10rem;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .naticon {
            background-image: url(../image/home/korea.png);
            width: 3rem;
            height: 2rem;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }

        .naticon:hover .naticonsub {
            opacity: 1;
        }

        .naticonsub {
            position: relative;
            top: 4rem;
            right: 1.8rem;
            background-color: #002d72;
            width: 5.5rem;
            padding: 0.5rem;
            border: 0.2rem solid #ff5910;
            border-radius: 10%;
            opacity: 0;
            transition: 0.5s;
        }

        .subnat {
            display: flex;
            justify-content: start;
            align-items: center;
        }

        .naticonsub img {
            width: 3rem;
            height: 2rem;
            padding: 0.2rem;
            margin-right: 0.2rem;
        }

        /* ì„¹ì…˜ ë ˆì´ì•„ì›ƒ */
        .section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%
        }

        #container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .blankY {
            width: 100%;
            height: 80px;
        }

        .boxTitle {
            display: block;
            font-size: 1.8rem;
            font-weight: bold;
            letter-spacing: 1px;
            

        }

        /********** ì²« ë²ˆì§¸ ì¤„ ***********/
        .weather-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 96%;
            margin-bottom: 50px;
        }

        /********** ë‘ ë²ˆì§¸ ì¤„ **********/


        /*********** ì„¸ ë²ˆì§¸ ì¤„ ***********/
        .directions-box {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            width: 90%;
        }

        /* ë‚ ì”¨ ì•„ì´ì½˜ */
        .weather-icon {
            width: 5rem;
            height: auto;
            margin-left: auto;
        }

        /* ë‚ ì”¨ í…ìŠ¤íŠ¸ */
        .weather-text {
            font-size: 1.2rem;
            line-height: 1.5;
        }

        .weather-box,
        .forecast-box,
        .search-box,
        .directions-box {
            text-align: center;
            margin: auto;
            padding: 10px;
            border: none;
            border-radius: 6px;
            background-color: rgba(250, 250, 250, 0.7);
            overflow: hidden;
        }

        .weather-box,
        .forecast-box {
            width: 48%;
            height: 15rem;
            padding: 10px;
            border: none;
            background-color: rgba(250, 250, 250, 0.7);
            border-radius: 6px;
            box-sizing: border-box;
        }

        .search-box {
            width: 48%;
            height: 12rem;
            padding: 10px;
            border: none;
            background-color: #f9f9f9;
            box-sizing: border-box;
        }

        #forecast {
            list-style: none;
            padding: 0;
            margin: 0;

        }

        .forecast-item {
            text-align: left;
            padding-left: 50px;
            display: flex;
            align-items: center;

        }

        .forecast-detail1 {
            display: inline-block;
            vertical-align: middle;
        }

        .forecast-item img {
            margin-right: 10px;
        }

        .directions-box {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            margin-top: 10px;
        }

        .directions-box {
            width: 91%;
            margin-bottom: 19px;
        }

        .directions-box button {
            width: 100px;
            height: 60px;
            padding: 10px;
            background: #002d72;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 5px;
        }

        .directions-box button:hover {
            background: #ff5910;
        }

        .directions-box h2 {
            width: 100%;
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 0;

        }

        .search-box input {
            padding: 5px;
            width: 50%;
        }

        .search-box button {
            padding: 6px 10px;
            background: blue;
            color: white;
            border: none;
            cursor: pointer;
        }


        @media (max-width: 1100px) {

            .forecast-item {
                padding-left: 10px;
                display: flex;
                align-items: center;
            }
        }


        @media (max-width: 850px) {
            .forecast-detail1 {
                display: none;
            }
            .forecast-detail2 {
                display: none;
            
            }

        }

        @media (max-width: 600px) {
            .forecast-detail2 {
                display: none;
                font-size: 1rem;
            }
            .forecast-detail3 {
                font-size: 13px;
            }

        }
    </style>
</head>

<body>

    <header>
        <div class="logo">
            <img src="./image/home/logo.png" alt="ë¡œê³ ">
        </div>
        <nav>
            <div>TOUR</div>
            <div>FOOD</div>
            <div>STAY</div>
            <div>INFO</div>
        </nav>
        <div class="hdicons">
            <div class="naticon">
                <div class="naticonsub">
                    <div class="subnat"><img src="./image/home/america.png" alt="usa">ENG</div>
                    <div class="subnat"><img src="./image/home/japan.png" alt="japan">JAP</div>
                    <div class="subnat"><img src="./image/home/china.png" alt="china">CHI</div>
                </div>
            </div>
        </div>
    </header>
    <!-- ì„¹ì…˜ì‹œì‘ì„ -->
    <section class="section"
        style="background-image: url('./image/info/infobg2.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
        <div id="container">
            <div class="blankY"></div>
            <div class="weather-container">
                <div class="weather-box">
                    <h2 class="boxTitle">í˜„ì¬ë‚ ì”¨</h2>
                    <div class="weather-content">
                        <img id="weather-icon" class="weather-icon" src="" alt="ë‚ ì”¨ ì•„ì´ì½˜">
                        <div id="weather-text" class="weather-text"></div>
                    </div>
                </div>

                <div class="forecast-box">
                    <h2 class="boxTitle">ì¼ê¸°ì˜ˆë³´</h2>
                    <ul id="forecast">Loading...</ul>
                </div>
            </div>

            <div class="directions-box">
                <h2>ğŸš¦ ì‹¤ì‹œê°„ êµí†µì²´ì¦</h2>
                <button onclick="openDirections('í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥')">í•´ìš´ëŒ€<br>í•´ìˆ˜ìš•ì¥</button>
                <button onclick="openDirections('ì†¡ì •í•´ìˆ˜ìš•ì¥')">ì†¡ì •<br>í•´ìˆ˜ìš•ì¥</button>
                <button onclick="openDirections('ë™ë°±ì„¬')">ë™ë°±ì„¬</button>
                <button onclick="openDirections('ë‹¬ë§ì´ê¸¸')">ë‹¬ë§ì´ê¸¸</button>
                <button onclick="openDirections('ë”ë² ì´101')">ë”ë² ì´<br>101</button>
                <button onclick="openDirections('ì„¼í…€ì‹œí‹°')">ì„¼í…€ì‹œí‹°</button>
                <button onclick="openDirections('í•´ìš´ëŒ€ì „í†µì‹œì¥')">í•´ìš´ëŒ€<br>ì „í†µì‹œì¥</button>
                <button onclick="openDirections('ë¸”ë£¨ë¼ì¸íŒŒí¬')">ë¸”ë£¨<br>ë¼ì¸íŒŒí¬</button>
                <div id="map"></div>
            </div>

            <div class="directions-box">
                <h2>ğŸš— ë„¤ë¹„ê²Œì´ì…˜</h2>
                <button id="navbtn" onclick="searchPlace('í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥')">í•´ìš´ëŒ€<br>í•´ìˆ˜ìš•ì¥</button>
                <button id="navbtn" onclick="searchPlace('ì†¡ì •í•´ìˆ˜ìš•ì¥')">ì†¡ì •<br>í•´ìˆ˜ìš•ì¥</button>
                <button id="navbtn" onclick="searchPlace('ë™ë°±ì„¬')">ë™ë°±ì„¬</button>
                <button id="navbtn" onclick="searchPlace('ë‹¬ë§ì´ê¸¸')">ë‹¬ë§ì´ê¸¸</button>
                <button id="navbtn" onclick="searchPlace('ë”ë² ì´101')">ë”ë² ì´<br>101</button>
                <button id="navbtn" onclick="searchPlace('ì„¼í…€ì‹œí‹°')">ì„¼í…€ì‹œí‹°</button>
                <button id="navbtn" onclick="searchPlace('í•´ìš´ëŒ€ì „í†µì‹œì¥')">í•´ìš´ëŒ€<br>ì „í†µì‹œì¥</button>
                <button id="navbtn" onclick="searchPlace('ë¸”ë£¨ë¼ì¸íŒŒí¬')">ë¸”ë£¨<br>ë¼ì¸íŒŒí¬</button>
            </div>



        </div>
    </section>


    <script>
        const weatherApiKey = 'a64a5c4f491cc98941022c90285932bc';
        const city = 'Busan';

        function getWeatherIcon(weatherMain, weatherDescription, isDaytime) {
            const iconMap = {
                "Clear": isDaytime ? "01d.png" : "01n.png",
                "Few Clouds": isDaytime ? "02d.png" : "02n.png",
                "Scattered Clouds": "03d.png",
                "Broken Clouds": isDaytime ? "04d.png" : "04n.png",
                "Clouds": "03d.png",
                "Shower Rain": isDaytime ? "09d.png" : "09n.png",
                "Rain": isDaytime ? "10d.png" : "10n.png",
                "Thunderstorm": isDaytime ? "11d.png" : "11n.png",
                "Snow": isDaytime ? "13d.png" : "13n.png",
                "Mist": isDaytime ? "50d.png" : "50n.png"
            };

            return iconMap[weatherMain] || "01d.png";
        }

        function fetchWeather() {
            const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${weatherApiKey}&units=metric&lang=kr`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log("API ì‘ë‹µ (í˜„ì¬ ë‚ ì”¨):", data);

                    const weatherMain = data.weather[0].main;
                    const weatherDescription = data.weather[0].description;
                    const temperature = data.main.temp;
                    const cloudiness = data.clouds.all;
                    const currentHour = new Date().getHours();
                    const isDaytime = currentHour >= 6 && currentHour < 18;
                    const iconFileName = getWeatherIcon(weatherMain, weatherDescription, isDaytime);
                    const iconPath = `./image/info/${iconFileName}`;

                    console.log("ì´ë¯¸ì§€ ê²½ë¡œ:", iconPath);

                    // ì•„ì´ì½˜ ë° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                    document.getElementById('weather-icon').src = iconPath;
                    document.getElementById('weather-text').innerHTML =
                        `"${weatherDescription}" [ ğŸŒ¡ï¸: ${temperature.toFixed(1)}Â°C <span class="forecast-detail1">/ ğŸ’¦: ${cloudiness}%</span> ]`;
                })
                .catch(error => {
                    console.error("ë‚ ì”¨ API í˜¸ì¶œ ì‹¤íŒ¨:", error);
                    document.getElementById('weather-text').innerText = 'ë‚ ì”¨ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨';
                });
        }

        function fetchForecast() {
            const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${weatherApiKey}&units=metric&lang=kr`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log("API ì‘ë‹µ (ì¼ê¸°ì˜ˆë³´):", data);

                    const forecasts = data.list
                        .filter((_, index) => index % 8 == 0)
                        .slice(0, 4)
                        .map(entry => {
                            const date = new Date(entry.dt * 1000);
                            const formattedDate = date.toLocaleDateString('ko-KR');
                            const isDaytime = date.getHours() >= 6 && date.getHours() < 18;
                            const forecastMain = entry.weather[0].main;
                            const forecastDescription = entry.weather[0].description;
                            const cloudiness = entry.clouds.all;
                            const forecastIconFileName = getWeatherIcon(forecastMain, forecastDescription, isDaytime);
                            const forecastIconPath = `./image/info/${forecastIconFileName}`;

                            console.log("ì˜ˆë³´ ë‚ ì§œ:", formattedDate, "ì•„ì´ì½˜ ê²½ë¡œ:", forecastIconPath);

                            return `<li class="forecast-item">
                        <img src="${forecastIconPath}" alt="ì˜ˆë³´ ì•„ì´ì½˜" style="width:30px; height:30px; vertical-align:middle;">
                       <span class ="forecast-detail2">${formattedDate}</span> <span class="forecast-detail1">"${forecastDescription}"</span><span class = "forecast-detail3">[ğŸŒ¡ï¸ : ${entry.main.temp.toFixed(1)}Â°C / ğŸ’¦ : ${cloudiness}% ]
                    </span></li>`;
                        })
                        .join('');

                    document.getElementById('forecast').innerHTML = forecasts;
                })
                .catch(error => {
                    console.error("ì˜ˆë³´ API í˜¸ì¶œ ì‹¤íŒ¨:", error);
                    document.getElementById('forecast').innerHTML = 'ë‚ ì”¨ ì˜ˆë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨';
                });
        }
        fetchWeather();
        fetchForecast();

        //--------------------------------------------------ë‚ ì”¨ ë
        let center = {
            "í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥": { lat: 35.1587, lng: 129.1604 },
            "ì†¡ì •í•´ìˆ˜ìš•ì¥": { lat: 35.1800, lng: 129.1994 },
            "ë™ë°±ì„¬": { lat: 35.1532, lng: 129.1527 },
            "ë‹¬ë§ì´ê¸¸": { lat: 35.1674, lng: 129.1780 },
            "ë”ë² ì´101": { lat: 35.1535, lng: 129.1520 },
            "ì„¼í…€ì‹œí‹°": { lat: 35.1698, lng: 129.1307 },
            "í•´ìš´ëŒ€ì „í†µì‹œì¥": { lat: 35.1633, lng: 129.1633 },
            "ë¸”ë£¨ë¼ì¸íŒŒí¬": { lat: 35.1601, lng: 129.1635 }
        };

        let map, marker, infowindow;
        let trafficLayerOn = false;

        function initMap() {
            var mapContainer = document.getElementById('map');

            if (!mapContainer) {
                console.error("map ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            var mapOption = {
                center: new kakao.maps.LatLng(center["í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥"].lat, center["í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥"].lng), // ê¸°ë³¸ ì¤‘ì‹¬ (í•´ìš´ëŒ€ í•´ìˆ˜ìš•ì¥)
                level: 4
            };

            map = new kakao.maps.Map(mapContainer, mapOption);
            marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(center["í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥"].lat, center["í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥"].lng),
                map: map
            });

            infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });
            infowindow.setContent(`<div style="padding:5px; font-size:14px; text-align: center;">í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥</div>`);
            infowindow.open(map, marker);

            //  ê¸°ë³¸ì ìœ¼ë¡œ êµí†µì •ë³´ ì¶”ê°€
            map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);
            trafficLayerOn = true;

            // ì§€ë„ê°€ ë³´ì´ëŠ” ì‹œì ì— relayout ì ìš©
            setTimeout(() => {
                console.log("map.relayout() ì‹¤í–‰");
                map.relayout();
            }, 500);
        }

        function openDirections(place) {
            if (!center[place]) {
                alert("ì¥ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            var position = new kakao.maps.LatLng(center[place].lat, center[place].lng);
            map.setCenter(position);

            if (marker) {
                marker.setMap(null);
            }

            marker = new kakao.maps.Marker({
                position: position,
                map: map
            });

            infowindow.setContent(`<div style="padding:5px; font-size:14px; text-align: center;">${place}</div>`);
            infowindow.open(map, marker);
        }

        function toggleTraffic() {
            if (trafficLayerOn) {
                map.removeOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);
                trafficLayerOn = false;
                console.log("ğŸš¦ êµí†µì •ë³´ OFF");
            } else {
                map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);
                trafficLayerOn = true;
                console.log("ğŸš¦ êµí†µì •ë³´ ON");
            }
        }

        //Kakao API ë¡œë“œ í›„ ì‹¤í–‰
        kakao.maps.load(initMap);

        // ì¨ì¹˜í”Œë ˆì´ì“°
        function searchPlace(place) {
            window.open(`https://map.kakao.com/?q=${place}`, '_blank');
        }

        document.addEventListener('DOMContentLoaded', () => {

            document.getElementById('searchBtn').addEventListener('click', () => {
                const query = document.getElementById('searchQuery').value.trim();
                if (query) window.open(`https://map.kakao.com/?q=${query}`, '_blank');
            });
        });

    </script>

</body>

</html>